
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE HTML>
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
    <title>Questionnaire - Form - FHIR v4.0.1</title>
    <link href="./lforms.min.css" rel="stylesheet"/>


  </head>

  <body onload="document.body.style.opacity='1'">

    <div class="container">  <!-- container -->
    <h2 id="root">Form: FINDRISC Test Questionnaire - Form</h2>
    <br/>

 
    <div id=formContainer></div>
    <br> </br>


<!-- image start --> 
<section id="main">
  <div class="inner">
    <div class="box alt">
      <div class="row 50% uniform">
         <div class="4u">
           <figure>
             <img src="findriscmapping.png" alt="" class="thumbnail">
           </figure>
         </div>

       </div>
     </div>
   </div>
 </section>
<!-- image end -->



    <button onclick="showQR()">
    Transform
    </button>
    <br> </br>
    
    <script src="./lforms.min.js"></script>
    <script src="./lformsFHIR.min.js"></script>
    
 
    <script>
  
      $.getJSON("questionnaire.json", function(data){
        exps = data;
        // Define a FHIR Questionnaire
        var fhirQ = data;

        // Add the form to the page
        LForms.Util.addFormToPage(fhirQ, 'formContainer');
        
        // Define the function for showing the QuestionnaireResponse

      }).fail(function(){
            console.log("An error has occurred.");
      });

    </script>
    


<script>
function showQR() {
        var qr = LForms.Util.getFormFHIRData('QuestionnaireResponse', 'R4');
//        window.alert(JSON.stringify(qr, null, 2));
          try {
             var input = eval('(' + JSON.stringify(qr) + ')');
			       $('#json-rendererQR').json_viewer(input);
          }
          catch (error) {
			        alert("Cannot eval JSON: " + error);
        	}
;
        $.ajaxSetup({
            headers: {
                'Content-Type': 'application/fhir+json;fhirVersion=4.0',
                'Accept': 'application/fhir+json;fhirVersion=4.0'
            }
        });

        $.post("http://localhost:8080/matchbox/fhir/StructureMap/$transform?source=http://hl7belgium.org/matchbox/fml/extractfindrisc",
        JSON.stringify(qr),
        function(data, status){
            console.log(data);
            //window.alert(JSON.stringify(data, null, 2))

            try {
             var input = eval('(' + JSON.stringify(data) + ')');
			       $('#json-renderer').json_viewer(input);
           }
           catch (error) {
			        alert("Cannot eval JSON: " + error);
        	 }



          });




      }
    </script>

<table>
  <td>
    <div class="column">
      <pre id="json-rendererQR"></pre>
    </div>
  </td>
  <td>
    <div class="column">
      <pre id="json-renderer"></pre>
    </div>
  </td>
</table>



    </div>  <!-- /container -->

  <script type="text/javascript" src="./jquery.js"> </script>     <!-- note keep space here, otherwise it will be transformed to empty tag -> fails -->
  <script type="text/javascript" src="./jquery-ui.min.js"> </script>

  <script src="./jquery.json-viewer.js"></script>
  <link href="./jquery.json-viewer.css" type="text/css" rel="stylesheet" />
  <link href="./jquerysctipttop.css" rel="stylesheet" type="text/css">
  <style type="text/css">

table td, table td * {
    vertical-align: top;
}

img { 
  width:200px;
  border:1px solid black; /* This is only added for testing purposes*/
  margin-left:calc(25px)
}

.thumbnail:hover {
   width: 90%;
   height:auto;
   position:relative;
   /* push image to the right by 1/2 the screen width and 1/2 the image width */
   margin-left:calc(50px + 50% - 600px);
}

body {
margin: 0;
font-family: sans-serif;
}
textarea#json-input {
width: 100%;
height: 200px;

  .column {
  float: left;
  width: 50%;
  }

  pre {
  float: left;
  width: 50%;
  }

  .row:after {
  content: "";
  display: table;
  clear: both;
  }
}

  </style>

  <script>
$(function() {
$('#btn-json-viewer').click(function() {
  try {
    var input = eval('(' + $('#json-input').val() + ')');
    $('#json-renderer').json_viewer(input);
  }
  catch (error) {
    alert("Cannot eval JSON: " + error);
  }
});

// Display JSON sample on load
$('#btn-json-viewer').click();
});
  </script>

  
  </body>
</html>

